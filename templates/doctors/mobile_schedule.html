{% extends 'dashboard/mobile/base.html' %}
{% load static %}

{% block title %}Dr. {{ doctor.get_full_name }} Schedule - Ethiopian Hospital ERP{% endblock %}

{% block content %}
<!-- Mobile Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h4 mb-0">Dr. {{ doctor.get_full_name }}</h1>
        <p class="text-muted">{{ doctor.get_specialty_display }} - Schedule</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'doctors:doctor_detail' doctor.pk %}?mobile=1" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-arrow-left me-1"></i>Back
        </a>
        <a href="{% url 'appointments:appointment_add' %}?doctor={{ doctor.pk }}&mobile=1" class="btn btn-primary btn-sm">
            <i class="fas fa-calendar-plus me-1"></i>Book
        </a>
    </div>
</div>

<!-- Week Navigation -->
<div class="mobile-dashboard-card mb-3">
    <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
            <i class="fas fa-calendar text-ethiopia-green me-2"></i>
            Weekly Schedule
        </h6>
        <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-outline-primary active" onclick="showWeek('current')">This Week</button>
            <button type="button" class="btn btn-outline-primary" onclick="showWeek('next')">Next Week</button>
        </div>
    </div>
</div>

<!-- Schedule Cards -->
<div class="row g-3" id="scheduleContainer">
    {% for day in week_schedule %}
    <div class="col-12">
        <div class="mobile-dashboard-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">{{ day.name }}</h6>
                <small class="text-muted">{{ day.date|date:"M d" }}</small>
            </div>
            
            {% if day.appointments %}
                {% for appointment in day.appointments %}
                <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                    <div>
                        <div class="fw-semibold">{{ appointment.appointment_time|time:"g:i A" }}</div>
                        <div class="small text-muted">{{ appointment.patient.get_full_name }}</div>
                        <div class="small">{{ appointment.get_appointment_type_display }}</div>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-{% if appointment.status == 'scheduled' %}primary{% elif appointment.status == 'completed' %}success{% elif appointment.status == 'in_progress' %}warning{% else %}secondary{% endif %}">
                            {{ appointment.get_status_display }}
                        </span>
                        <div class="small text-muted">{{ appointment.duration|default:"30" }} min</div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center py-3">
                    <i class="fas fa-calendar-times text-muted fa-2x mb-2"></i>
                    <p class="text-muted mb-0">No appointments scheduled</p>
                </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Statistics -->
<div class="row g-3 mt-2">
    <div class="col-6">
        <div class="mobile-dashboard-card text-center">
            <div class="stat-number text-ethiopia-green">{{ week_stats.total_appointments|default:0 }}</div>
            <div class="stat-label">This Week</div>
        </div>
    </div>
    <div class="col-6">
        <div class="mobile-dashboard-card text-center">
            <div class="stat-number text-ethiopia-blue">{{ week_stats.available_slots|default:0 }}</div>
            <div class="stat-label">Available Slots</div>
        </div>
    </div>
</div>

<!-- Working Hours -->
<div class="mobile-dashboard-card">
    <h6 class="card-title">
        <i class="fas fa-clock text-ethiopia-yellow me-2"></i>
        Working Hours
    </h6>
    
    <div class="row g-2">
        <div class="col-6">
            <small class="text-muted">Monday - Friday</small>
            <div class="fw-semibold">8:00 AM - 5:00 PM</div>
        </div>
        <div class="col-6">
            <small class="text-muted">Saturday</small>
            <div class="fw-semibold">9:00 AM - 1:00 PM</div>
        </div>
        <div class="col-6">
            <small class="text-muted">Sunday</small>
            <div class="fw-semibold">Closed</div>
        </div>
        <div class="col-6">
            <small class="text-muted">Lunch Break</small>
            <div class="fw-semibold">12:00 PM - 1:00 PM</div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="mobile-dashboard-card">
    <h6 class="card-title">
        <i class="fas fa-cogs text-ethiopia-red me-2"></i>
        Quick Actions
    </h6>
    
    <div class="d-grid gap-2">
        <a href="{% url 'appointments:appointment_add' %}?doctor={{ doctor.pk }}&mobile=1" class="btn btn-primary btn-sm">
            <i class="fas fa-calendar-plus me-2"></i>Schedule New Appointment
        </a>
        
        <button class="btn btn-outline-info btn-sm" onclick="viewAvailability()">
            <i class="fas fa-clock me-2"></i>Check Availability
        </button>
        
        <button class="btn btn-outline-success btn-sm" onclick="exportSchedule()">
            <i class="fas fa-download me-2"></i>Export Schedule
        </button>
        
        <a href="{% url 'doctors:doctor_detail' doctor.pk %}?mobile=1" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-user-md me-2"></i>View Doctor Profile
        </a>
    </div>
</div>

<!-- Availability Legend -->
<div class="mobile-dashboard-card">
    <h6 class="card-title">
        <i class="fas fa-info-circle text-ethiopia-blue me-2"></i>
        Status Legend
    </h6>
    
    <div class="row g-2">
        <div class="col-6">
            <span class="badge bg-primary me-2">Scheduled</span>
            <small>Confirmed appointment</small>
        </div>
        <div class="col-6">
            <span class="badge bg-warning me-2">In Progress</span>
            <small>Currently seeing patient</small>
        </div>
        <div class="col-6">
            <span class="badge bg-success me-2">Completed</span>
            <small>Appointment finished</small>
        </div>
        <div class="col-6">
            <span class="badge bg-secondary me-2">Cancelled</span>
            <small>Appointment cancelled</small>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.stat-number {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 0.25rem;
}

.stat-label {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
}

.mobile-dashboard-card {
    margin-bottom: 1.5rem;
}

.mobile-dashboard-card h6 {
    color: #2c3e50;
    font-weight: 600;
    border-bottom: 2px solid rgba(0, 150, 57, 0.1);
    padding-bottom: 0.5rem;
}

.btn-group-sm .btn {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
}

@media (max-width: 768px) {
    .stat-number {
        font-size: 1.5rem;
    }
    
    .d-flex.gap-2 {
        flex-wrap: wrap;
    }
    
    .btn-sm {
        font-size: 0.75rem;
        padding: 0.375rem 0.75rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function showWeek(week) {
    // Update active button
    document.querySelectorAll('.btn-group .btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // In a real implementation, this would load the schedule for the selected week
    if (window.mobileDashboard) {
        mobileDashboard.showMobileNotification(`Loading ${week} week schedule...`, 'info');
    }
    
    // Simulate loading
    setTimeout(() => {
        if (window.mobileDashboard) {
            mobileDashboard.showMobileNotification(`${week.charAt(0).toUpperCase() + week.slice(1)} week schedule loaded!`, 'success');
        }
    }, 1000);
}

function viewAvailability() {
    if (window.mobileDashboard) {
        mobileDashboard.showMobileNotification('Availability checker coming soon!', 'info');
    } else {
        alert('Availability checker coming soon!');
    }
}

function exportSchedule() {
    if (window.mobileDashboard) {
        mobileDashboard.showMobileNotification('Schedule export coming soon!', 'info');
    } else {
        alert('Schedule export coming soon!');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('Mobile doctor schedule loaded');
    
    // Show mobile notification if coming from detail page
    if (document.referrer.includes('/doctors/') && document.referrer.includes('mobile=1')) {
        if (window.mobileDashboard) {
            mobileDashboard.showMobileNotification('Schedule loaded successfully!', 'success');
        }
    }
});
</script>
{% endblock %}
