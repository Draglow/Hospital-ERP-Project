{% extends 'dashboard/mobile/base.html' %}
{% load static %}

{% block title %}{{ medicine.name }} - Ethiopian Hospital ERP{% endblock %}

{% block content %}
<!-- Mobile Page Header - Match Desktop -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h4 mb-0">{{ medicine.name }}</h1>
        <p class="text-muted">{{ medicine.strength }} {{ medicine.get_form_display }} - {{ medicine.get_category_display }}</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'pharmacy:medicine_list' %}?mobile=1" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-arrow-left me-1"></i>Back
        </a>
        <a href="{% url 'pharmacy:medicine_edit' medicine.pk %}?mobile=1" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-edit me-1"></i>Edit
        </a>
        <button class="btn btn-success btn-sm" onclick="dispenseMedicine()">
            <i class="fas fa-hand-holding-medical me-1"></i>Dispense
        </button>
    </div>
</div>

<!-- Main Content -->
<div class="row g-3">
    <div class="col-12">
        <div class="mobile-dashboard-card">
            <!-- Medicine Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="card-title mb-0">Medicine Information</h5>
                <span class="badge bg-{% if medicine.current_stock > medicine.minimum_stock %}success{% elif medicine.current_stock > 0 %}warning{% else %}danger{% endif %} fs-6">
                    {% if medicine.current_stock > medicine.minimum_stock %}
                        In Stock
                    {% elif medicine.current_stock > 0 %}
                        Low Stock
                    {% else %}
                        Out of Stock
                    {% endif %}
                </span>
            </div>


            <!-- Basic Information Section -->
            <div class="mb-4">
                <h6 class="mb-3">
                    <i class="fas fa-pills text-ethiopia-green me-2"></i>
                    Basic Information
                </h6>

                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Medicine Name</label>
                        <div class="fw-semibold">{{ medicine.name }}</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Generic Name</label>
                        <div>{{ medicine.generic_name|default:"Not specified" }}</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Strength</label>
                        <div>{{ medicine.strength }}</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Form</label>
                        <div>{{ medicine.get_form_display }}</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Category</label>
                        <div>{{ medicine.get_category_display }}</div>
                    </div>
                </div>
            </div>

            <!-- Manufacturing Details Section -->
            <div class="mb-4">
                <h6 class="mb-3">
                    <i class="fas fa-industry text-ethiopia-blue me-2"></i>
                    Manufacturing Details
                </h6>

                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Manufacturer</label>
                        <div>{{ medicine.manufacturer|default:"Not specified" }}</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Batch Number</label>
                        <div>{{ medicine.batch_number|default:"Not specified" }}</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Expiry Date</label>
                        <div>{{ medicine.expiry_date|date:"F d, Y" }}</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Prescription Required</label>
                        <div>
                            {% if medicine.prescription_required %}
                                <span class="badge bg-warning">Yes</span>
                            {% else %}
                                <span class="badge bg-success">No</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <!-- Inventory Information Section -->
            <div class="mb-4">
                <h6 class="mb-3">
                    <i class="fas fa-warehouse text-ethiopia-yellow me-2"></i>
                    Inventory Information
                </h6>

                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Current Stock</label>
                        <div class="fw-semibold fs-4 text-success">{{ medicine.current_stock|default:0 }} units</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Minimum Stock Level</label>
                        <div>{{ medicine.minimum_stock|default:0 }} units</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Unit Price</label>
                        <div class="fw-semibold text-ethiopia-green fs-5">{{ medicine.unit_price|floatformat:2 }} ETB</div>
                    </div>
                </div>
            </div>

            <!-- Storage Information Section -->
            <div class="mb-4">
                <h6 class="mb-3">
                    <i class="fas fa-thermometer-half text-ethiopia-red me-2"></i>
                    Storage Information
                </h6>

                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Storage Temperature</label>
                        <div>Room Temperature (15-25°C)</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label text-muted">Stock Status</label>
                        <div>
                            <span class="badge bg-{% if medicine.current_stock > medicine.minimum_stock %}success{% elif medicine.current_stock > 0 %}warning{% else %}danger{% endif %}">
                                {% if medicine.current_stock > medicine.minimum_stock %}
                                    Adequate Stock
                                {% elif medicine.current_stock > 0 %}
                                    Low Stock
                                {% else %}
                                    Out of Stock
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Stock Overview -->
    <div class="col-12">
        <div class="mobile-dashboard-card">
            <h6 class="card-title">
                <i class="fas fa-chart-pie text-ethiopia-green me-2"></i>
                Stock Overview
            </h6>
            <div class="text-center">
                <div class="progress mb-3" style="height: 20px;">
                    {% if medicine.current_stock > 0 and medicine.minimum_stock > 0 %}
                        {% widthratio medicine.current_stock medicine.minimum_stock 100 as stock_percentage %}
                        <div class="progress-bar bg-{% if medicine.current_stock > medicine.minimum_stock %}success{% elif medicine.current_stock > 0 %}warning{% else %}danger{% endif %}" style="width: {{ stock_percentage|default:0 }}%"></div>
                    {% else %}
                        <div class="progress-bar bg-danger" style="width: 0%"></div>
                    {% endif %}
                </div>
                <div class="small">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Current:</span>
                        <span>{{ medicine.current_stock|default:0 }} units</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Minimum:</span>
                        <span>{{ medicine.minimum_stock|default:0 }} units</span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Quick Actions -->
    <div class="col-12">
        <div class="mobile-dashboard-card">
            <h6 class="card-title">
                <i class="fas fa-cogs text-ethiopia-yellow me-2"></i>
                Quick Actions
            </h6>
            <div class="d-grid gap-2">
                <button class="btn btn-success btn-sm" onclick="dispenseMedicine()">
                    <i class="fas fa-hand-holding-medical me-2"></i>Dispense Medicine
                </button>

                <button class="btn btn-primary btn-sm" onclick="addStock()">
                    <i class="fas fa-plus me-2"></i>Add Stock
                </button>

                <a href="{% url 'pharmacy:medicine_edit' medicine.pk %}?mobile=1" class="btn btn-outline-warning btn-sm">
                    <i class="fas fa-edit me-2"></i>Edit Details
                </a>

                <button class="btn btn-outline-info btn-sm" onclick="printLabel()">
                    <i class="fas fa-print me-2"></i>Print Label
                </button>
            </div>
        </div>
    </div>

    <!-- Safety Information -->
    <div class="col-12">
        <div class="mobile-dashboard-card">
            <h6 class="card-title">
                <i class="fas fa-shield-alt text-ethiopia-red me-2"></i>
                Safety Information
            </h6>
            <div class="small">
                <p class="mb-2">• Store in cool, dry place</p>
                <p class="mb-2">• Keep away from children</p>
                <p class="mb-0">• Check expiry date before dispensing</p>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block extra_css %}
<style>
.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
}

.mobile-dashboard-card {
    margin-bottom: 1.5rem;
}

.mobile-dashboard-card h6 {
    color: #2c3e50;
    font-weight: 600;
    border-bottom: 2px solid rgba(0, 150, 57, 0.1);
    padding-bottom: 0.5rem;
}

.badge.fs-6 {
    font-size: 0.875rem !important;
    padding: 0.5rem 0.75rem;
}

.progress-bar {
    transition: width 0.6s ease;
}

@media (max-width: 768px) {
    .d-flex.gap-2 {
        flex-wrap: wrap;
    }

    .btn-sm {
        font-size: 0.75rem;
        padding: 0.375rem 0.75rem;
    }

    .fs-4 {
        font-size: 1.25rem !important;
    }

    .fs-5 {
        font-size: 1.1rem !important;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function dispenseMedicine() {
    const quantity = prompt('Enter quantity to dispense:');
    if (quantity && parseInt(quantity) > 0) {
        if (window.mobileDashboard) {
            mobileDashboard.showMobileNotification('Dispensed ' + quantity + ' units successfully!', 'success');
        }
        setTimeout(() => location.reload(), 1000);
    }
}

function addStock() {
    window.location.href = '{% url "pharmacy:stock_adjustment" medicine.pk %}?mobile=1';
}

function printLabel() {
    window.print();
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('Mobile medicine detail loaded');

    // Show mobile notification if coming from list
    if (document.referrer.includes('/pharmacy/') && document.referrer.includes('mobile=1')) {
        if (window.mobileDashboard) {
            mobileDashboard.showMobileNotification('Medicine details loaded successfully!', 'success');
        }
    }

    // Update progress bar animation
    const progressBar = document.querySelector('.progress-bar');
    if (progressBar) {
        setTimeout(() => {
            progressBar.style.width = progressBar.style.width;
        }, 500);
    }
});
</script>
{% endblock %}
