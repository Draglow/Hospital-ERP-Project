{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}{{ medicine.name }} - Ethiopian Hospital ERP{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-0">{{ medicine.name }}</h1>
        <p class="text-muted">{{ medicine.strength }} {{ medicine.get_form_display }} - {{ medicine.get_category_display }}</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'pharmacy:medicine_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Pharmacy
        </a>
        <a href="{% url 'pharmacy:medicine_edit' medicine.pk %}" class="btn btn-outline-primary">
            <i class="fas fa-edit me-2"></i>Edit Medicine
        </a>
        <button class="btn btn-success" onclick="dispenseMedicine()">
            <i class="fas fa-hand-holding-medical me-2"></i>Dispense
        </button>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="dashboard-card">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="card-title mb-0">Medicine Information</h5>
                <span class="badge bg-success fs-6">In Stock</span>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <h6 class="mb-3">
                        <i class="fas fa-pills text-ethiopia-green me-2"></i>
                        Basic Information
                    </h6>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Medicine Name</label>
                        <div class="fw-semibold">{{ medicine.name }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Generic Name</label>
                        <div>{{ medicine.generic_name|default:"Not specified" }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Strength</label>
                        <div>{{ medicine.strength }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Form</label>
                        <div>{{ medicine.get_form_display }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Category</label>
                        <div>{{ medicine.get_category_display }}</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <h6 class="mb-3">
                        <i class="fas fa-industry text-ethiopia-blue me-2"></i>
                        Manufacturing Details
                    </h6>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Manufacturer</label>
                        <div>{{ medicine.manufacturer|default:"Not specified" }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Batch Number</label>
                        <div>{{ medicine.batch_number|default:"Not specified" }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Expiry Date</label>
                        <div>{{ medicine.expiry_date|date:"F d, Y" }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Prescription Required</label>
                        <div>
                            {% if medicine.prescription_required %}
                                <span class="badge bg-warning">Yes</span>
                            {% else %}
                                <span class="badge bg-success">No</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <hr>
            
            <div class="row">
                <div class="col-md-6">
                    <h6 class="mb-3">
                        <i class="fas fa-warehouse text-ethiopia-yellow me-2"></i>
                        Inventory Information
                    </h6>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Current Stock</label>
                        <div class="fw-semibold fs-4 text-success">{{ medicine.current_stock }} units</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Minimum Stock Level</label>
                        <div>{{ medicine.minimum_stock }} units</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Unit Price</label>
                        <div class="fw-semibold text-ethiopia-green fs-5">{{ medicine.unit_price|floatformat:2 }} ETB</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <h6 class="mb-3">
                        <i class="fas fa-thermometer-half text-ethiopia-red me-2"></i>
                        Storage Information
                    </h6>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Storage Temperature</label>
                        <div>Room Temperature (15-25°C)</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-muted">Stock Status</label>
                        <div><span class="badge bg-success">Adequate Stock</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="dashboard-card">
            <h6 class="card-title">
                <i class="fas fa-chart-pie text-ethiopia-green me-2"></i>
                Stock Overview
            </h6>
            <div class="text-center">
                <div class="progress mb-3" style="height: 20px;">
                    <div class="progress-bar bg-success" style="width: 85%"></div>
                </div>
                <div class="small">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Current:</span>
                        <span>{{ medicine.current_stock }} units</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Minimum:</span>
                        <span>{{ medicine.minimum_stock }} units</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-card">
            <h6 class="card-title">
                <i class="fas fa-cogs text-ethiopia-yellow me-2"></i>
                Quick Actions
            </h6>
            <div class="d-grid gap-2">
                <button class="btn btn-success btn-sm" onclick="dispenseMedicine()">
                    <i class="fas fa-hand-holding-medical me-2"></i>Dispense Medicine
                </button>
                
                <button class="btn btn-primary btn-sm" onclick="addStock()">
                    <i class="fas fa-plus me-2"></i>Add Stock
                </button>
                
                <a href="{% url 'pharmacy:medicine_edit' medicine.pk %}" class="btn btn-outline-warning btn-sm">
                    <i class="fas fa-edit me-2"></i>Edit Details
                </a>
                
                <button class="btn btn-outline-info btn-sm" onclick="printLabel()">
                    <i class="fas fa-print me-2"></i>Print Label
                </button>
            </div>
        </div>
        
        <div class="dashboard-card">
            <h6 class="card-title">
                <i class="fas fa-shield-alt text-ethiopia-red me-2"></i>
                Safety Information
            </h6>
            <div class="small">
                <p class="mb-2">• Store in cool, dry place</p>
                <p class="mb-2">• Keep away from children</p>
                <p class="mb-0">• Check expiry date before dispensing</p>
            </div>
        </div>
    </div>
</div>

<script>
function dispenseMedicine() {
    const quantity = prompt('Enter quantity to dispense:');
    if (quantity && parseInt(quantity) > 0) {
        alert('Dispensed ' + quantity + ' units');
        location.reload();
    }
}

function addStock() {
    window.location.href = '{% url "pharmacy:stock_adjustment" medicine.pk %}';
}

function printLabel() {
    window.print();
}
</script>
{% endblock %}
